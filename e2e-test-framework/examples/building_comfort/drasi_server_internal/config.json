{
  "data_store": {
      "data_store_path": "examples/building_comfort/drasi_server_internal/test_data_cache",
      "delete_on_start": true,
      "delete_on_stop": true,
      "test_repos": [
          {
              "id": "drasi_server_dev_repo",
              "kind": "LocalStorage",
              "source_path": "examples/building_comfort/drasi_server_internal/dev_repo",
              "local_tests": [
                {
                    "test_id": "building_comfort",
                    "version": 1,
                    "description": "Building comfort monitoring test with internal Drasi Server",
                    "test_folder": "building_comfort",
                    "drasi_servers": [
                        {
                        "id": "internal-drasi-server",
                        "name": "Internal Drasi Server for Building Comfort",
                        "description": "Embedded Drasi Server instance for testing",
                        "config": {
                            "binding": {
                            "host": "127.0.0.1",
                            "port": 0
                            },
                            "runtime": {
                            "workers": 4,
                            "queue_size": 1000
                            },
                            "storage": {
                            "type": "memory"
                            },
                            "log_level": "info",
                            "sources": [
                            {
                                "name": "facilities-db",
                                "source_type": "internal.application",
                                "auto_start": true,
                                "properties": {}
                            }
                            ],
                            "queries": [
                            {
                                "name": "all-rooms",
                                "query": "MATCH (r:Room) RETURN elementId(r) AS RoomId, 50 + (r.temperature - 72) + (r.humidity - 42) + (r.co2 / 25) AS ComfortLevel",
                                "sources": ["facilities-db"],
                                "auto_start": true,
                                "properties": {}
                            }
                            ],
                            "reactions": [
                            {
                                "name": "building-comfort-alerts",
                                "reaction_type": "internal.application",
                                "queries": ["all-rooms"],
                                "auto_start": true,
                                "properties": {}
                            }
                            ]
                        }
                        }
                    ],
                    "queries": [],
                    "sources": [
                        {
                        "test_source_id": "facilities-db",
                        "kind": "Model",
                        "source_change_dispatchers": [ 
                            {
                            "kind": "DrasiServerChannel",
                            "drasi_server_id": "internal-drasi-server",
                            "source_id": "facilities-db",
                            "buffer_size": 2048
                            }
                        ],
                        "model_data_generator": {
                            "kind": "BuildingHierarchy",
                            "change_interval": [5000000000, 1000000000, 1000000000, 5000000000],
                            "change_count": 100000,
                            "send_initial_inserts": true,
                            "seed": 123456789,
                            "spacing_mode": "none",
                            "time_mode": "2025-01-03T10:03:15.4Z",
                            "building_count": [1, 0],
                            "floor_count": [1, 0],
                            "room_count": [1, 0],                   
                            "room_sensors": [
                            {
                                "kind": "NormalFloat",
                                "id": "temperature",
                                "momentum_init": [5, 1, 0.5],
                                "value_change": [1, 0.5],
                                "value_init": [72, 5],
                                "value_range": [20, 110]
                            },
                            {
                                "kind": "NormalFloat",
                                "id": "co2",
                                "momentum_init": [10, 1, 0.5],
                                "value_change": [20, 5.0],
                                "value_init": [100, 10],
                                "value_range": [50, 1000]
                            },
                            {
                                "kind": "NormalFloat",
                                "id": "humidity",
                                "momentum_init": [5, 1, 0.5],
                                "value_change": [1, 0.5],
                                "value_init": [42, 3],
                                "value_range": [0, 100]
                            }
                            ]
                        },
                        "subscribers": []
                        }
                    ],
                    "reactions": [
                        {
                        "test_reaction_id": "building-comfort",
                        "output_handler": {
                            "kind": "DrasiServerChannel",
                            "drasi_server_id": "internal-drasi-server",
                            "reaction_id": "building-comfort-alerts",
                            "buffer_size": 1024
                        },
                        "stop_triggers": [
                            {
                            "kind": "RecordCount",
                            "record_count": 90000
                            }
                        ]
                        }
                    ]
                    }
              ]
          }                    
      ]
  },
  "test_run_host": {
      "drasi_servers": [
          {
              "test_id": "building_comfort",
              "test_repo_id": "drasi_server_dev_repo",
              "test_run_id": "test_run_001",
              "test_drasi_server_id": "internal-drasi-server",
              "start_immediately": true
          }
      ],
      "queries": [],
      "reactions": [
          {
              "test_id": "building_comfort",
              "test_repo_id": "drasi_server_dev_repo",
              "test_run_id": "test_run_001",
              "test_reaction_id": "building-comfort",
              "start_immediately": true,
              "output_loggers": [
                  {
                      "kind": "JsonlFile",
                      "max_lines_per_file": 15000
                  }
              ]
          }
      ],
      "sources": [
          {
              "test_id": "building_comfort",
              "test_repo_id": "drasi_server_dev_repo",                
              "test_run_id": "test_run_001",
              "test_source_id": "facilities-db",
              "start_mode": "auto",
              "test_run_overrides" : {
                "model_data_generator": {}              
              }
          }
      ]
  }
}